
function respuesta() {

  var hoja = SpreadsheetApp.openById("1Z8WTT0D5hPS-F2DKoSfvPZGukOQ39toPbGDyP-alV6w");
  var respuesta = hoja.getSheetByName("Respuestas de formulario 1");
  var horas_seleccionadas = hoja.getSheetByName("Horarios");

  var lastRow_respuesta = respuesta.getLastRow();
  var lastRow_horas_seleccionadas = horas_seleccionadas.getLastRow();

  var respuesta_usuario = respuesta.getRange("L" + lastRow_respuesta).getValue();
  var respuesta_usuario2 = respuesta.getRange("I" + lastRow_respuesta).getValue();

  var cont = 2;
  while (cont <= lastRow_horas_seleccionadas) {
    if (horas_seleccionadas.getRange("C" + cont).getValue() == "") {
      if (respuesta_usuario != "") {
        horas_seleccionadas.getRange("C" + cont).setValue(respuesta_usuario);

      } else {
        horas_seleccionadas.getRange("C" + cont).setValue(respuesta_usuario2);

      }


      break;
    }
    cont++;
  }

  horario();
}

function colocarHoras(){
  var hoja = SpreadsheetApp.openById("1Z8WTT0D5hPS-F2DKoSfvPZGukOQ39toPbGDyP-alV6w");
  var horas_seleccionadas = hoja.getSheetByName("Horarios");
  var form = FormApp.openById('1wKbD4joE0Ihozu4OZN1Srxbas03BKUNkGfRWZ32Hyo0');
  var horas=horas_seleccionadas.getRange(2,1,horas_seleccionadas.getLastRow(),1).getValues();
  var opciones=[];
  horas.forEach(function(item){
  opciones.push(item[0]);
  })
  var formItem=form.getItemById("140575188");
  var formItem2=form.getItemById("180342011");
  formItem.asListItem().setChoiceValues(opciones);
  formItem2.asListItem().setChoiceValues(opciones);
}

function horario() {
  // actualizar Formulario
  var hoja = SpreadsheetApp.openById("1Z8WTT0D5hPS-F2DKoSfvPZGukOQ39toPbGDyP-alV6w");
  var horas_seleccionadas = hoja.getSheetByName("Horarios");

  var lastRow_horas_seleccionadas = horas_seleccionadas.getLastRow();
  var array = [];
  for (let i = 2; i <= lastRow_horas_seleccionadas; i++) {
    array.push(horas_seleccionadas.getRange("A" + i).getValue())
  }
  var array2 = [];
  for (let i = 2; i <= lastRow_horas_seleccionadas; i++) {
    horas_seleccionadas.getRange("C" + i).getValue() != "" ? array2.push(horas_seleccionadas.getRange("C" + i).getValue()) : console.log("No entra");

  }

  for (let i = 0; i < array2.length; i++) {
    array.splice(array.indexOf(array2[i]), 1)
    var form = FormApp.openById('1wKbD4joE0Ihozu4OZN1Srxbas03BKUNkGfRWZ32Hyo0');
    var item = form.getItemById(140575188);
    var item2 = form.getItemById(180342011);
      var email = Session.getActiveUser().getEmail();
     
    if (array.length == [0]) {
      item.asListItem().setChoiceValues([""]);
      item2.asListItem().setChoiceValues([""]);


    }
    item.asListItem().setChoiceValues(array);
    item2.asListItem().setChoiceValues(array);
  }
}

function restablecerHorarios() {
  var hoja = SpreadsheetApp.openById("1Z8WTT0D5hPS-F2DKoSfvPZGukOQ39toPbGDyP-alV6w");
  var horas_seleccionadas = hoja.getSheetByName("Horarios");

  var lastRow_horas_seleccionadas = horas_seleccionadas.getLastRow();
  var array = [];
  var array2 = [];
  for (let i = 2; i <= lastRow_horas_seleccionadas; i++) {
    array.push(horas_seleccionadas.getRange("A" + i).getValue())
    array2.push(horas_seleccionadas.getRange("C" + i).clearContent())
  }
  var form = FormApp.openById('1wKbD4joE0Ihozu4OZN1Srxbas03BKUNkGfRWZ32Hyo0');
  var item = form.getItemById(140575188);
  var item2 = form.getItemById(180342011);
  item.asListItem().setChoiceValues(array);
  item2.asListItem().setChoiceValues(array);
}

function notAcceptingResponses() {
  let form = FormApp.getActiveForm();
  form.setAcceptingResponses(false);
}

function acceptingResponses() {
  let form = FormApp.getActiveForm();
  form.setAcceptingResponses(true);
}

function triggerCreation() {
  ScriptApp.newTrigger("notAcceptingResponses")
    .timeBased()
    .atHour(9)
    .nearMinute(30)
    .everyDays(1) // Frequency is required if you are using atHour() or nearMinute()
    .inTimezone("America/Bogota")
    .create();

  ScriptApp.newTrigger("acceptingResponses")
    .timeBased()
    .atHour(4)
    .nearMinute(30)
    .everyDays(1) // Frequency is required if you are using atHour() or nearMinute()
    .inTimezone("America/Bogota")
    .create();
}

